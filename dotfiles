#!/bin/bash
#
# pbrisbin 2010
#
###

errorout() { echo "$*" >&2; exit 1; }

# location of git controlled dotfiles
dotfiles="$HOME/.dotfiles"

# get sed scrubme pattern from a mod 600 cred file
. /home/patrick/.credentials

# if we don't now know what to scrub, GTFO
[[ -z "$scrubme" ]] && errorout 'scrub pattern not found'

clean='.bashrc
       .Xdefaults
       .xcolors/zenburn.xcolors
       .xcolors/jasonwryan.xcolors
       .xinitrc
       .screenrc
       .vimrc
       .conkyrc
       .dmenurc
       .dzen_conkyrc
       .dvdcopy.conf
       .config/aurgetrc
       .config/openbox/rc.xml
       .config/openbox/menu.xml
       .ncmpcpp/config
       .irssi/my.theme'

dirty='.mutt/muttrc
       .mutt/gmx.muttrc
       .mutt/gmail.muttrc
       .mutt/colors.muttrc
       .mutt/sidebar.muttrc
       .offlineimaprc
       .msmtprc
       .irssi/config'

# copy clean dotfiles
for source in $clean; do
  if [[ -f "/home/patrick/$source" ]]; then
    dest="$dotfiles/${source}"
    cp "/home/patrick/$source" "$dest"
  fi
done

# copy dirty dotfiles
for source in $dirty; do
  if [[ -f "/home/patrick/$source" ]]; then
    dest="$dotfiles/${source}"
    sed "$scrubme" "/home/patrick/$source" > "$dest"
  fi
done

# update git
cd "$dotfiles"
git add .
git commit -m 'auto updated via script'
